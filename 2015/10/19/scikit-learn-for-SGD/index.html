<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <title>scikit-learn for SGD | 不如</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="SGD随机梯度下降在ML中十分高效。本文简要介绍一下它在scikit-learn的使用。原文地址：http://scikit-learn.org/stable/modules/sgd.html">
<meta property="og:type" content="article">
<meta property="og:title" content="scikit-learn for SGD">
<meta property="og:url" content="http://yoursite.com/2015/10/19/scikit-learn-for-SGD/index.html">
<meta property="og:site_name" content="不如">
<meta property="og:description" content="SGD随机梯度下降在ML中十分高效。本文简要介绍一下它在scikit-learn的使用。原文地址：http://scikit-learn.org/stable/modules/sgd.html">
<meta property="og:updated_time" content="2015-10-19T06:09:10.391Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="scikit-learn for SGD">
<meta name="twitter:description" content="SGD随机梯度下降在ML中十分高效。本文简要介绍一下它在scikit-learn的使用。原文地址：http://scikit-learn.org/stable/modules/sgd.html">
  
    <link rel="alternative" href="/atom.xml" title="不如" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/pp.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">刘思亮</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Heipiao" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
					        
								<a class="linkedin" target="_blank" href="/#" title="linkedin">linkedin</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/ML/" style="font-size: 15px;">ML</a> <a href="/tags/data/" style="font-size: 10px;">data</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/scikit-learn/" style="font-size: 10px;">scikit-learn</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">开始写程序~</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">刘思亮</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/pp.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">刘思亮</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Heipiao" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
			        
						<a class="linkedin" target="_blank" href="/#" title="linkedin">linkedin</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-scikit-learn-for-SGD" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/19/scikit-learn-for-SGD/" class="article-date">
  	<time datetime="2015-10-19T04:21:27.000Z" itemprop="datePublished">2015-10-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      scikit-learn for SGD
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>SGD随机梯度下降在ML中十分高效。本文简要介绍一下它在scikit-learn的使用。原文地址：<a href="http://scikit-learn.org/stable/modules/sgd.html" target="_blank" rel="external">http://scikit-learn.org/stable/modules/sgd.html</a><br><a id="more"></a><br>SGD十分成功的应用在大数据集的学习问题，尤其在文本挖掘和自然语言处理。它可以处理大于1w的特征。<br>他的优势在于：</p>
<ol>
<li>高效</li>
<li>易于使用</li>
</ol>
<p>他的劣势在于：</p>
<ol>
<li>SCD需要设定许多参数</li>
<li>对于特征规模十分敏感</li>
</ol>
<h1 id="分类">分类</h1><p>分类需要使用X，Y两个数组。</p>
<pre><code><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> SGDClassifier
<span class="prompt">&gt;&gt;&gt; </span>X = [[<span class="number">0.</span>, <span class="number">0.</span>], [<span class="number">1.</span>, <span class="number">1.</span>]]
<span class="prompt">&gt;&gt;&gt; </span>y = [<span class="number">0</span>, <span class="number">1</span>]
<span class="prompt">&gt;&gt;&gt; </span>clf = SGDClassifier(loss=<span class="string">"hinge"</span>, penalty=<span class="string">"l2"</span>)
<span class="prompt">&gt;&gt;&gt; </span>clf.fit(X, y)
SGDClassifier(alpha=<span class="number">0.0001</span>, average=<span class="keyword">False</span>, class_weight=<span class="keyword">None</span>, epsilon=<span class="number">0.1</span>,
   eta0=<span class="number">0.0</span>, fit_intercept=<span class="keyword">True</span>, l1_ratio=<span class="number">0.15</span>,
   learning_rate=<span class="string">'optimal'</span>, loss=<span class="string">'hinge'</span>, n_iter=<span class="number">5</span>, n_jobs=<span class="number">1</span>,
   penalty=<span class="string">'l2'</span>, power_t=<span class="number">0.5</span>, random_state=<span class="keyword">None</span>, shuffle=<span class="keyword">True</span>,
   verbose=<span class="number">0</span>, warm_start=<span class="keyword">False</span>)
</code></pre><p>对于loss函数，主要有以下几种：</p>
<ul>
<li>“hinge”:线性支持向量机</li>
<li>“modified_huber”:光滑的hinge损失函数</li>
<li>“log”: 逻辑回归</li>
</ul>
<p>后两种loss函数可以使用predict_proba方法，返回相应的概率对于每一种Y。</p>
<p>另外我们还可以使用惩罚因子这个参数，默认L2。</p>
<blockquote>
<p>The default setting is penalty=”l2”. The L1 penalty leads to sparse solutions, driving most coefficients to zero. The Elastic Net solves some deficiencies of the L1 penalty in the presence of highly correlated attributes. The parameter l1_ratio controls the convex combination of L1 and L2 penalty.</p>
</blockquote>
<p>#SGD 带有权重的例子#<br>原文地址：<a href="http://scikit-learn.org/stable/auto_examples/linear_model/plot_sgd_weighted_samples.html#example-linear-model-plot-sgd-weighted-samples-py" target="_blank" rel="external">http://scikit-learn.org/stable/auto_examples/linear_model/plot_sgd_weighted_samples.html#example-linear-model-plot-sgd-weighted-samples-py</a> </p>
<p>我们就只需要设定相应的权重值就可以。</p>
<pre><code>print<span class="params">(__doc__)</span>

<span class="built_in">import</span> numpy as np
<span class="built_in">import</span> matplotlib.pyplot as plt
from sklearn <span class="built_in">import</span> linear_model

<span class="built_in">#</span> we create <span class="number">20</span> points
np.random.seed<span class="params">(<span class="number">0</span>)</span>
X = np.r_[np.random.randn<span class="params">(<span class="number">10</span>, <span class="number">2</span>)</span> + [<span class="number">1</span>, <span class="number">1</span>], np.random.randn<span class="params">(<span class="number">10</span>, <span class="number">2</span>)</span>]
y = [<span class="number">1</span>] <span class="built_in">*</span> <span class="number">10</span> + [-<span class="number">1</span>] <span class="built_in">*</span> <span class="number">10</span>
sample_weight = <span class="number">100</span> <span class="built_in">*</span> np.<span class="built_in">abs</span><span class="params">(np.random.randn<span class="params">(<span class="number">20</span>)</span>)</span>
<span class="built_in">#</span> and <span class="built_in">assign</span> a bigger weight to the last <span class="number">10</span> samples
sample_weight[:<span class="number">10</span>] <span class="built_in">*</span>= <span class="number">10</span>

<span class="built_in">#</span> plot the weighted data points
xx, yy = np.meshgrid<span class="params">(np.linspace<span class="params">(-<span class="number">4</span>,     <span class="number">5</span>, <span class="number">500</span>)</span>, np.linspace<span class="params">(-<span class="number">4</span>, <span class="number">5</span>, <span class="number">500</span>)</span>)</span>
plt.figure<span class="params">()</span>
plt.scatter<span class="params">(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], c=y,         s=sample_weight, alpha=<span class="number">0.9</span>,
            cmap=plt.cm.bone)</span>

<span class="built_in">#</span><span class="built_in">#</span> fit the unweighted model
clf = linear_model.SGDClassifier<span class="params">(alpha=<span class="number">0.01</span>, n_iter=<span class="number">100</span>)</span>
clf.fit<span class="params">(X, y)</span>
Z = clf.decision_function<span class="params">(np.c_[xx.ravel<span class="params">()</span>, yy.ravel<span class="params">()</span>])</span>
Z = Z.reshape<span class="params">(xx.shape)</span>    
no_weights = plt.contour<span class="params">(xx, yy, Z,     levels=[<span class="number">0</span>], linestyles=['solid'])</span>

<span class="built_in">#</span><span class="built_in">#</span> fit the weighted model
clf = linear_model.SGDClassifier    <span class="params">(alpha=<span class="number">0.01</span>, n_iter=<span class="number">100</span>)</span>
clf.fit<span class="params">(X, y, sample_weight=sample_weight)</span>
Z = clf.decision_function<span class="params">(np.c_[xx.ravel<span class="params">()</span>, yy.ravel<span class="params">()</span>])</span>
Z = Z.reshape<span class="params">(xx.shape)</span>
samples_weights = plt.contour<span class="params">(xx, yy, Z, levels=[<span class="number">0</span>], linestyles=['dashed'])</span>

plt.legend<span class="params">([no_weights.collections[<span class="number">0</span>], samples_weights.collections[<span class="number">0</span>]],
       [<span class="string">"no weights"</span>, <span class="string">"with weights"</span>], loc=<span class="string">"lower left"</span>)</span>

plt.xticks<span class="params">(<span class="params">()</span>)</span>
plt.yticks<span class="params">(<span class="params">()</span>)</span>
plt.show<span class="params">()</span>
</code></pre><h1 id="使用技巧">使用技巧</h1><ul>
<li><p>SGD对于特征的规模十分敏感，所以十分推荐整理你的规模。另外要注意，当你对你的数据进行了[0,1]或者[-1,+1]的整理，一定要对你的测试数据进行相同的处理。这里可以使用StandardScaler包来简单的完成这个任务。</p>
<p>  from sklearn.preprocessing import StandardScaler<br>  scaler = StandardScaler()<br>  scaler.fit(X_train)  # Don’t cheat - fit only on training data<br>  X_train = scaler.transform(X_train)<br>  X_test = scaler.transform(X_test)  # apply same transformation to test data</p>
</li>
<li><p>选择合适的正则化参数，使用GridSearchCV，经常的范围在10.0**-np.arange(1,7).</p>
</li>
<li><p>迭代次数要等于测试集的大小。</p>
<blockquote>
<p>Empirically, we found that SGD converges after observing approx. 10^6 training samples. Thus, a reasonable first guess for the number of iterations is n_iter = np.ceil(10**6 / n), where n is the size of the training set.</p>
</blockquote>
</li>
<li><p>If you apply SGD to features extracted using PCA we found that it is often wise to scale the feature values by some constant c such that the average L2 norm of the training data equals one.</p>
</li>
<li>We found that Averaged SGD works best with a larger number of features and a higher eta0 </li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/10/20/特征工程/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          特征工程
        
      </div>
    </a>
  
  
    <a href="/2015/10/18/Support-Vector-Machines/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Support Vector Machines</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="scikit-learn-for-SGD" data-title="scikit-learn for SGD" data-url="http://yoursite.com/2015/10/19/scikit-learn-for-SGD/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 刘思亮
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>